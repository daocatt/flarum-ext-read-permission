(()=>{var o={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},d:(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t),r:o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}},t={};(()=>{"use strict";o.r(t);const e=flarum.core.compat["common/app"];o.n(e)().initializers.add("nodeloc/flarum-ext-read-permission",(function(){console.log("[nodeloc/flarum-ext-read-permission] Hello, forum and admin!")}));const r=flarum.core.compat["forum/app"];var s=o.n(r);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["common/utils/classList"];var i=o.n(a);const c=flarum.core.compat["forum/components/DiscussionComposer"];var l=o.n(c);function u(o,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},u(o,t)}const d=flarum.core.compat["common/components/Button"];var p=o.n(d);const f=flarum.core.compat["common/components/Modal"];var h=o.n(f);flarum.core.compat["common/components/Switch"];const b=flarum.core.compat["common/utils/ItemList"];var v=o.n(b);flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/utils/extractText"],flarum.core.compat["common/components/Select"];const y=flarum.core.compat["common/components/Dropdown"];var P=o.n(y);const g=flarum.core.compat["common/helpers/icon"];var _=o.n(g);const M=flarum.core.compat["common/models/Group"];var x=o.n(M),G=function(o){function t(){return o.apply(this,arguments)||this}var e,r;r=o,(e=t).prototype=Object.create(r.prototype),e.prototype.constructor=e,u(e,r);var n=t.prototype;return n.oninit=function(t){o.prototype.oninit.call(this,t),this.attrs.selectGroup?this.group=this.attrs.selectGroup:this.group=s().store.getById("groups",x().MEMBER_ID)},n.title=function(){return s().translator.trans("nodeloc-read-permission.forum.modal.add_title")},n.className=function(){return"ReadPermissionDiscussionModal Modal--medium"},n.content=function(){return[m("div",{className:"Modal-body"},m("div",{className:"ReadPermissionDiscussionModal-form"},this.fields().toArray()))]},n.fields=function(){var o=this,t=new(v()),e={3:"fas fa-user"};return t.add("readPermission",m("div",{className:"Form-group"},m("label",{className:"label"},s().translator.trans("nodeloc-read-permission.forum.modal.readPermission_placeholder")),m(P(),{label:[_()(this.group.icon()||e[this.group.id()]),"\t",this.group.namePlural()," - ",this.group.data.attributes.readPermission],buttonClassName:"Button Button--danger"},s().store.all("groups").filter((function(o){return 2!=o.id()})).sort((function(o,t){return o.data.attributes.readPermission-t.data.attributes.readPermission})).map((function(t){return p().component({active:o.group.id()===t.id(),icon:t.icon()||e[t.id()],onclick:function(){o.group=t}},[t.namePlural()," - ",t.data.attributes.readPermission])})))),100),t.add("submit",m("div",{className:"Form-group"},p().component({type:"submit",className:"Button Button--primary ReadPermissionModal-SubmitButton",loading:this.loading},s().translator.trans("nodeloc-read-permission.forum.modal.submit"))),-10),t},n.onsubmit=function(o){var t=this;o.preventDefault();var e=this.group;if(null!==e){var r=this.attrs.onsubmit(e);r instanceof Promise?(this.loading=!0,r.then(this.hide.bind(this),(function(o){console.error(o),t.onerror(o),t.loaded()}))):s().modal.close()}},t}(h());s().initializers.add("nodeloc/flarum-ext-read-permission",(function(){var o;console.log("[nodeloc/flarum-ext-read-permission] Hello, forum!"),(o=l()).prototype.addReadPermission=function(){var o=this;s().modal.show(G,{selectGroup:this.composer.fields.selectGroup,onsubmit:function(t){return o.composer.fields.selectGroup=t}})},(0,n.extend)(o.prototype,"headerItems",(function(o){var t;null==(t=this.composer.body)||null==(t=t.attrs)||t.discussion,o.add("readPermission",m("a",{className:"ComposerBody-readPermission",onclick:this.addReadPermission.bind(this)},m("span",{className:i()("readPermissionLabel",!this.composer.fields.selectGroup&&"none")},s().translator.trans("nodeloc-read-permission.forum.composer_discussion."+(this.composer.fields.selectGroup?"edit":"add")+"_readPermission"))),4)})),(0,n.extend)(o.prototype,"data",(function(o){this.composer.fields.selectGroup&&(o.readPermission=this.composer.fields.selectGroup.data.attributes.readPermission)}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map