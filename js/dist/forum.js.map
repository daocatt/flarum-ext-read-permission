{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nodeloc/flarum-ext-read-permission/webpack/bootstrap","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/compat get default export","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/define property getters","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/make namespace object","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/app']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/common/index.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/app']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/extend']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@nodeloc/flarum-ext-read-permission/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Select']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/models/Group']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/components/CreateReadPermissionModal.js","webpack://@nodeloc/flarum-ext-read-permission/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/index.js","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/addComposerItems.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('nodeloc/flarum-ext-read-permission', () => {\n  console.log('[nodeloc/flarum-ext-read-permission] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Select'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","import app from 'flarum/forum/app';\n\nimport Button from 'flarum/common/components/Button';\nimport Modal from 'flarum/common/components/Modal';\nimport Switch from 'flarum/common/components/Switch';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Stream from 'flarum/common/utils/Stream';\nimport extractText from 'flarum/common/utils/extractText';\nimport Select from \"flarum/common/components/Select\";\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport icon from 'flarum/common/helpers/icon';\nimport Group from 'flarum/common/models/Group';\n\nexport default class CreateReadPermissionModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    if(this.attrs.selectGroup){\n      this.group = this.attrs.selectGroup;\n    }else{\n      this.group = app.store.getById('groups', Group.MEMBER_ID);\n    }\n  }\n\n  title() {\n    return app.translator.trans('nodeloc-read-permission.forum.modal.add_title');\n  }\n\n  className() {\n    return 'ReadPermissionDiscussionModal Modal--medium';\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"ReadPermissionDiscussionModal-form\">{this.fields().toArray()}</div>\n      </div>,\n    ];\n  }\n\n  fields() {\n    const items = new ItemList();\n    const icons = {\n      3: 'fas fa-user',\n    };\n    items.add(\n      'readPermission',\n      <div className=\"Form-group\">\n        <label\n          className=\"label\">{app.translator.trans('nodeloc-read-permission.forum.modal.readPermission_placeholder')}</label>\n        <Dropdown label={[icon(this.group.icon() || icons[this.group.id()]), '\\t', this.group.namePlural(), ' - ', this.group.data.attributes.readPermission]} buttonClassName=\"Button Button--danger\">\n        {app.store\n          .all('groups')\n          .filter((g) => g.id() != 2)\n          .sort((a, b) => a.data.attributes.readPermission - b.data.attributes.readPermission)\n          .map((g) =>\n            Button.component(\n              {\n                active: this.group.id() === g.id(),\n                icon: g.icon() || icons[g.id()],\n                onclick: () => {\n                  this.group = g; // 更新 group 的值为当前被点击的组\n                },\n              },\n              [g.namePlural(), ' - ', g.data.attributes.readPermission] // 在组名和 read_permission 之间添加文字\n              )\n          )}\n        </Dropdown>\n      </div>,\n      100\n    );\n\n    items.add(\n      'submit',\n      <div className=\"Form-group\">\n        {Button.component(\n          {\n            type: 'submit',\n            className: 'Button Button--primary ReadPermissionModal-SubmitButton',\n            loading: this.loading,\n          },\n          app.translator.trans('nodeloc-read-permission.forum.modal.submit')\n        )}\n      </div>,\n      -10\n    );\n    return items;\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    const data = this.group;\n\n    if (data === null) {\n      return;\n    }\n    const promise = this.attrs.onsubmit(data);\n\n    if (promise instanceof Promise) {\n      this.loading = true;\n\n      promise.then(this.hide.bind(this), (err) => {\n        console.error(err);\n        this.onerror(err);\n        this.loaded();\n      });\n    } else {\n      app.modal.close();\n    }\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/forum/app';\nimport addComposerItems from './addComposerItems';\n\napp.initializers.add('nodeloc/flarum-ext-read-permission', () => {\n  console.log('[nodeloc/flarum-ext-read-permission] Hello, forum!');\n  addComposerItems();\n});\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport classList from 'flarum/common/utils/classList';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\n\nimport CreateReadPermissionModal from './components/CreateReadPermissionModal';\n\nexport const addToComposer = (composer) => {\n  composer.prototype.addReadPermission = function () {\n    app.modal.show(CreateReadPermissionModal, {\n      selectGroup: this.composer.fields.selectGroup,\n      onsubmit: (selectGroup) => (this.composer.fields.selectGroup = selectGroup),\n    });\n  };\n\n  // Add button to DiscussionComposer header\n  extend(composer.prototype, 'headerItems', function (items) {\n    const discussion = this.composer.body?.attrs?.discussion;\n    items.add(\n      'readPermission',\n      <a className=\"ComposerBody-readPermission\" onclick={this.addReadPermission.bind(this)}>\n        <span className={classList('readPermissionLabel', !this.composer.fields.selectGroup && 'none')}>\n          {app.translator.trans(`nodeloc-read-permission.forum.composer_discussion.${this.composer.fields.selectGroup ? 'edit' : 'add'}_readPermission`)}\n        </span>\n      </a>,\n      4\n    );\n\n  });\n\n  extend(composer.prototype, 'data', function (data) {\n    if (this.composer.fields.selectGroup) {\n      data.readPermission = this.composer.fields.selectGroup.data.attributes.readPermission;\n    }\n  });\n};\n\nexport default () => {\n  addToComposer(DiscussionComposer);\n};\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","console","log","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","CreateReadPermissionModal","_Modal","apply","arguments","subClass","superClass","create","constructor","_proto","oninit","vnode","this","attrs","selectGroup","group","getById","Group","title","trans","className","content","m","fields","toArray","_this","items","ItemList","icons","Dropdown","label","icon","id","namePlural","data","attributes","readPermission","buttonClassName","all","filter","g","sort","b","map","Button","active","onclick","type","loading","onsubmit","e","_this2","preventDefault","promise","Promise","then","hide","err","error","onerror","loaded","close","Modal","composer","DiscussionComposer","addReadPermission","show","extend","_this$composer$body","body","discussion","classList"],"sourceRoot":""}